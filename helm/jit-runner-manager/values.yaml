# JIT Runner Manager Helm Values
# 기본 설정 - 환경에 맞게 수정하세요

# ============================================================================
# 기본 설정
# ============================================================================

replicaCount: 2

image:
  repository: your-registry/jit-runner-manager
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# ============================================================================
# GitHub Enterprise Server 설정
# ============================================================================

config:
  # GitHub Enterprise Server URL
  ghesUrl: "https://github.example.com"
  
  # Organization별 최대 동시 Runner 수
  maxRunnersPerOrg: 10
  
  # 전체 최대 동시 Runner 수
  maxTotalRunners: 200
  
  # Runner 라벨 (쉼표로 구분)
  runnerLabels: "code-linux"
  
  # Runner 그룹
  runnerGroup: "default"
  
  # Runner Pod가 생성될 네임스페이스
  runnerNamespace: "jit-runners"
  
  # 로그 레벨: DEBUG, INFO, WARNING, ERROR
  logLevel: "INFO"

# ============================================================================
# Runner Pod 설정
# ============================================================================

runner:
  # Runner 이미지
  image: "ghcr.io/actions/actions-runner:latest"
  
  # Runner 리소스 설정
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "2"
      memory: "4Gi"
  
  # Docker-in-Docker 설정
  dind:
    enabled: true
    image: "docker:dind"
    resources:
      requests:
        cpu: "500m"
        memory: "1Gi"
      limits:
        cpu: "2"
        memory: "4Gi"

# ============================================================================
# Secrets (외부에서 생성하거나 여기서 참조)
# ============================================================================

secrets:
  # GitHub PAT (이미 생성된 Secret 이름)
  githubPat:
    existingSecret: "github-credentials"
    key: "pat"
  
  # Webhook Secret (이미 생성된 Secret 이름)
  webhookSecret:
    existingSecret: "webhook-secret"
    key: "secret"

# ============================================================================
# Redis 설정
# ============================================================================

redis:
  # 내장 Redis 사용 여부
  enabled: true
  
  # Bitnami Redis Chart 설정
  architecture: standalone
  auth:
    enabled: false
  master:
    persistence:
      enabled: true
      size: 1Gi
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

# 외부 Redis 사용 시
externalRedis:
  enabled: false
  url: "redis://external-redis:6379/0"
  # 인증이 필요한 경우
  # password: ""
  # existingSecret: ""
  # passwordKey: ""

# ============================================================================
# Celery Worker 설정
# ============================================================================

celery:
  # Worker 레플리카 수
  replicaCount: 3
  
  # Worker concurrency
  concurrency: 10
  
  # 리소스 설정
  resources:
    requests:
      cpu: "200m"
      memory: "256Mi"
    limits:
      cpu: "1"
      memory: "1Gi"
  
  # Beat 스케줄러 활성화
  beat:
    enabled: true
    resources:
      requests:
        cpu: "50m"
        memory: "64Mi"
      limits:
        cpu: "200m"
        memory: "256Mi"

# ============================================================================
# 서비스 설정
# ============================================================================

service:
  type: ClusterIP
  port: 8000

# ============================================================================
# Ingress 설정
# ============================================================================

ingress:
  enabled: true
  className: "nginx"
  annotations:
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: jit-runner.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: jit-runner-tls
  #    hosts:
  #      - jit-runner.example.com

# ============================================================================
# 서비스 계정 설정
# ============================================================================

serviceAccount:
  create: true
  annotations: {}
  name: "jit-runner-manager"

# ============================================================================
# RBAC 설정
# ============================================================================

rbac:
  create: true

# ============================================================================
# Pod 설정
# ============================================================================

podAnnotations: {}

podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000

# ============================================================================
# 리소스 설정 (Webhook Receiver)
# ============================================================================

resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "500m"
    memory: "512Mi"

# ============================================================================
# 스케줄링 설정
# ============================================================================

nodeSelector: {}

tolerations: []

affinity: {}

# ============================================================================
# 헬스 체크 설정
# ============================================================================

livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5

# ============================================================================
# 모니터링 설정
# ============================================================================

metrics:
  enabled: false
  serviceMonitor:
    enabled: false
    interval: 30s
    labels: {}

